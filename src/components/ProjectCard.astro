---
export interface Props {
  project: {
    slug: string;
    data: {
      title: string;
      description: string;
      excerpt?: string;
      coverImage: string;
      coverVideo?: string;
      tags: string[];
      techStack: string[];
      featured: boolean;
      status: string;
      role?: string;
      liveUrl?: string;
    };
  };
  index?: number;
}

const { project, index = 0 } = Astro.props;
import VercelImage from './VercelImage.astro';
import NeonCTA from './NeonCTA.astro';
---

<article 
  class="group relative glass-card glass-card-accent rounded-2xl p-6 md:p-8 backdrop-blur-md transition-all duration-300 hover:shadow-neon-lg hover:border-primary/60 reveal"
  role="article"
  aria-labelledby={`proj-${project.slug}-title`}
  style={`transition-delay:${index * 80}ms`}
>
  

  <!-- Project Cover -->
    <div class="relative overflow-hidden h-44 md:h-52 mb-6 rounded-xl content-visibility-auto holo-frame">
    <picture>
      <source srcset="/images/project-card-1-bg-800.avif 800w, /images/project-card-1-bg-480.avif 480w" type="image/avif" />
      <source srcset="/images/project-card-1-bg-800.webp 800w, /images/project-card-1-bg-480.webp 480w" type="image/webp" />
      <img src="/images/project-card-1-bg.png" alt="" class="absolute inset-0 w-full h-full object-cover opacity-15" width="1200" height="480" loading="lazy" decoding="async" aria-hidden="true" sizes="(max-width: 768px) 100vw, 600px" />
    </picture>
    {project.data.coverVideo ? (
      <video
        class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500 motion-reduce:transition-none"
        autoplay
        muted
        loop
        playsinline
        preload="metadata"
        poster={project.data.coverImage}
      >
        <source src={project.data.coverVideo} type="video/mp4" />
        <VercelImage src={project.data.coverImage} alt={`${project.data.title} cover image`} class="w-full h-full object-cover" loading="lazy" decoding="async" fetchpriority="low" />
      </video>
    ) : (
      <VercelImage
        src={project.data.coverImage}
        alt={`${project.data.title} cover image`}
        class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500 motion-reduce:transition-none"
        loading="lazy"
        decoding="async"
        fetchpriority="low"
        sizes="(max-width: 768px) 100vw, 600px"
      />
    )}
    
    <!-- Overlay with neon glow effect -->
    <div class="absolute inset-0 bg-gradient-to-t from-background/80 to-transparent opacity-0 
                group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"></div>
  </div>

  <!-- Project Content -->
    <div>
      <h3 id={`proj-${project.slug}-title`} class="text-2xl md:text-[1.6rem] font-orbitron neon-heading mb-3">
        {project.data.title}
      </h3>
      
      <p class="text-sm md:text-base text-text-muted mb-5">
        {project.slug === 'upiria'
          ? 'Built a scalable frontend and testing foundation at an early stage of a fast-growing travel startup.'
          : project.slug === 'casa-capoeira'
          ? 'Created a fast, reliable CMS to help capoeira schools manage classes, payments, and community with ease.'
          : (project.data.excerpt || project.data.description)}
      </p>

      <!-- HUD-style metadata -->
      <div class="rounded-lg border border-primary/30 bg-card/40 p-4 mb-6">
        <div class="text-xs md:text-sm font-mono text-matrix-white/80 tracking-tight">
          <div class="flex flex-wrap gap-2 md:gap-3 items-start mb-1">
            <span class="text-neon-lime/90">Focus:</span>
            <span class="text-neon-lime/90">{project.data.role ?? (project.slug === 'upiria' ? 'Frontend + QA' : 'Fullâ€‘Stack + Product')}</span>
          </div>
          <div class="my-2 h-px bg-primary/20"></div>
          <div class="flex flex-wrap gap-2 md:gap-3 items-start">
            <span class="text-neon-lime/90">Tech:</span>
            <span class="text-neon-lime/90">{project.data.techStack.slice(0,3).join(', ')}</span>
          </div>
        </div>
      </div>

      <!-- Dual CTA Buttons -->
      <div class="flex flex-col sm:flex-row gap-3 justify-center items-center">
        <!-- Learn More (Case Study) -->
        <a
          href={`/projects/${project.slug}`}
          class="inline-flex items-center justify-center px-4 py-2.5 bg-transparent border border-primary/40 text-primary hover:bg-primary/10 hover:border-primary/60 transition-all duration-300 rounded-lg text-sm font-medium group"
          aria-label={`Read case study: ${project.data.title}`}
        >
          <svg class="w-4 h-4 mr-2 group-hover:translate-x-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          Learn More
        </a>
        
        <!-- View Live (External Project) -->
        {project.data.liveUrl && (
          <NeonCTA 
            href={project.data.liveUrl} 
            ariaLabel={`Visit live project: ${project.data.title}`} 
            class="px-4 py-2.5 text-sm"
            text="View Live"
          />
        )}
      </div>
  </div>
</article>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style> 