---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import { imagePresets, defaultPreset } from '../../lib/image-presets';

export interface Props {
  src: ImageMetadata | string;
  alt?: string;
  width?: number;
  height?: number;
  class?: string;
  preset?: keyof typeof imagePresets;
  sizes?: string;
  loading?: 'eager' | 'lazy';
  decoding?: 'auto' | 'sync' | 'async';
  fetchpriority?: 'high' | 'low' | 'auto';
}

const {
  src,
  alt = '',
  width,
  height,
  class: className = '',
  preset,
  sizes,
  loading = 'lazy',
  decoding = 'async',
  fetchpriority = 'auto',
} = Astro.props;

const selectedPreset = preset ? imagePresets[preset] : defaultPreset;
const computedSizes = sizes ?? selectedPreset.sizes;

// Check if src is an imported image (ImageMetadata) or static path (string)
const isImportedImage = typeof src === 'object' && 'src' in src;
---

{isImportedImage ? (
  // Use Astro's Image component for imported images
  <Image
    src={src as ImageMetadata}
    alt={alt}
    widths={selectedPreset.widths}
    sizes={computedSizes}
    format="webp"
    class={className}
    loading={loading}
    decoding={decoding}
    fetchpriority={fetchpriority}
    {...(width ? { width } : {})}
    {...(height ? { height } : {})}
  />
) : (
  // Use regular img tag for static paths (already optimized)
  <img
    src={src as string}
    alt={alt}
    width={width}
    height={height}
    class={className}
    sizes={computedSizes}
    loading={loading}
    decoding={decoding}
    fetchpriority={fetchpriority}
  />
)}


