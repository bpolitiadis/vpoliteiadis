---
interface Project {
  title: string;
  description: string;
  website: string;
  image: string;
  technologies: string[];
}

const projects: Project[] = [
  {
    title: "Casa Capoeira",
    description: "A custom multilingual CMS for Capoeira Schools to manage events, blog posts, and media gallery.",
    website: "https://www.casacapoeira.org",
    image: "/images/casa-capoeira-cover.webp",
    technologies: ["Next.js", "Supabase", "TypeScript", "Playwright", "React", "Prisma", "i18n"],
  },
];

// Animation configuration - following HeroSection pattern
const ANIMATION_CONFIG = {
  card: {
    durations: [4, 3, 4, 3],
    movements: [
      { y: "-=8", x: "+=5", rotation: "-=0.5" },
      { y: "+=8", x: "-=5", rotation: "-=0.5" },
      { y: "-=6", rotation: "+=0.5" },
      { y: "+=6", rotation: "+=0.5" },
    ],
    movementsMobile: [
      { y: "-=4", x: "+=3", rotation: "-=0.25" },
      { y: "+=4", x: "-=3", rotation: "-=0.25" },
      { y: "-=3", rotation: "+=0.25" },
      { y: "+=3", rotation: "+=0.25" },
    ],
  },
  easing: "power1.easeInOut",
} as const;
---

<section
  id="projects"
  class="relative py-16 md:py-24 px-4 sm:px-6 lg:px-8 bg-matrix-black overflow-visible"
  role="region"
  aria-labelledby="projects-heading"
  data-projects-section
>
  {/* Background image */}
  <div class="absolute inset-0 z-0 overflow-hidden">
    <picture>
      <source srcset="/images/projects-bg.avif" type="image/avif" />
      <source srcset="/images/projects-bg.webp" type="image/webp" />
      <img
        src="/images/projects-bg.webp"
        alt=""
        class="w-full h-full object-cover"
        aria-hidden="true"
      />
    </picture>
    <div class="absolute inset-0 bg-matrix-black/60"></div>
  </div>

  {/* Background decorative elements */}
  <div class="absolute inset-0 z-0 overflow-hidden pointer-events-none">
    <div class="absolute top-0 left-1/4 w-px h-32 bg-gradient-to-b from-neon-lime/20 to-transparent" />
    <div class="absolute top-0 right-1/4 w-px h-32 bg-gradient-to-b from-digital-emerald/20 to-transparent" />
    <div class="absolute bottom-0 left-1/2 w-px h-24 bg-gradient-to-t from-neon-lime/10 to-transparent" />
  </div>

  <div class="max-w-7xl mx-auto relative z-10">
    {/* Section Headline */}
    <h2
      id="projects-heading"
      class="text-3xl md:text-4xl lg:text-5xl font-orbitron font-bold text-neon-lime text-center mb-12 md:mb-16 animate-reveal-up opacity-0"
      style="text-shadow: 0 0 20px rgba(57, 255, 20, 0.8), 0 0 40px rgba(57, 255, 20, 0.4)"
    >
      Featured Projects
    </h2>

    {/* Projects Grid */}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
      {projects.map((project, index) => (
        <div
          data-project-card={index}
          class="relative h-full flex flex-col rounded-2xl border border-digital-emerald/20 shadow-inner backdrop-blur-md transition-all duration-500 overflow-hidden group hover:border-neon-lime/60 hover:shadow-neon-lg hover:scale-[1.03] animate-reveal-up opacity-0 will-change-transform rounded-xl bg-card text-card-foreground shadow"
          style={`animation-delay: ${index * 150}ms; background-image: linear-gradient(rgba(10, 10, 10, 0.85), rgba(10, 10, 10, 0.9)), url(/images/project-card-1-bg.png); background-size: cover; background-position: center;`}
        >
          {/* Glowing top accent */}
          <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-neon-lime/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500" />

          {/* Project Image */}
          <div class="relative w-full overflow-hidden bg-dark-slate/60" style="aspect-ratio: 16 / 9">
            <a
              href={project.website}
              target="_blank"
              rel="noopener noreferrer"
              class="block w-full h-full relative hover:bg-transparent"
              aria-label={`Visit ${project.title} website`}
            >
              <img
                src={project.image}
                alt={project.title}
                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 will-change-transform"
                loading="lazy"
                decoding="async"
                width={1280}
                height={720}
                style="aspect-ratio: 16 / 9"
              />
              {/* Enhanced gradient overlay with neon glow */}
              <div class="pointer-events-none absolute inset-0 bg-gradient-to-t from-matrix-black/95 via-matrix-black/50 to-transparent opacity-90 group-hover:opacity-70 transition-opacity duration-500" />
              {/* Neon border effect on hover */}
              <div class="pointer-events-none absolute inset-0 border-2 border-transparent group-hover:border-neon-lime/40 transition-all duration-500 rounded-t-2xl group-hover:shadow-[0_0_20px_rgba(57,255,20,0.3)]" />
              {/* Corner accents */}
              <div class="pointer-events-none absolute top-2 left-2 w-3 h-3 border-t-2 border-l-2 border-neon-lime/0 group-hover:border-neon-lime/60 transition-all duration-500" />
              <div class="pointer-events-none top-2 right-2 w-3 h-3 border-t-2 border-r-2 border-neon-lime/0 group-hover:border-neon-lime/60 transition-all duration-500 absolute" />
            </a>
          </div>

          <div class="flex flex-col space-y-1.5 p-4 md:p-5 pt-4 space-y-2">
            <div class="font-semibold leading-none tracking-tight font-orbitron font-bold text-lg md:text-xl text-neon-lime group-hover:text-shadow-neon transition-all duration-300">
              <a
                href={project.website}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center gap-2 transition-all duration-200 hover:gap-3 text-primary underline-offset-4 hover:underline p-0 h-auto hover:text-neon-lime transition-colors justify-start font-inherit text-inherit"
              >
                {project.title}
                <span class="text-sm opacity-70 group-hover:opacity-100 group-hover:translate-x-1 group-hover:-translate-y-1 transition-all duration-200">â†—</span>
              </a>
            </div>
            <div class="text-sm text-muted-foreground text-sm text-matrix-white/85 leading-relaxed group-hover:text-matrix-white/95 transition-colors duration-300">
              {project.description}
            </div>
          </div>

          <div class="flex items-center p-4 md:p-5 pt-2 gap-2 flex-col items-start">
            <p class="text-xs font-orbitron text-digital-emerald/70 uppercase tracking-wider w-full group-hover:text-digital-emerald/90 transition-colors duration-300">
              Tech Stack
            </p>
            <div class="flex flex-wrap gap-2 w-full">
              {project.technologies.map((tech, techIndex) => (
                <div
                  class="inline-flex items-center rounded-full border border-digital-emerald/40 bg-digital-emerald/15 text-digital-emerald hover:border-digital-emerald/70 hover:bg-digital-emerald/25 hover:shadow-[0_0_8px_rgba(0,184,107,0.3)] transition-all duration-300 text-xs font-medium px-2.5 py-1 shadow-sm group-hover:scale-105 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"
                  style={`transition-delay: ${techIndex * 20}ms`}
                >
                  {tech}
                </div>
              ))}
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  import gsap from 'gsap';

  // IntersectionObserver and GSAP animations - vanilla JS implementation
  document.addEventListener('DOMContentLoaded', () => {
    const section = document.querySelector('[data-projects-section]');
    if (!section) return;

    // Check for reduced motion preference
    const prefersReducedMotion = window.matchMedia(
      '(prefers-reduced-motion: reduce)'
    ).matches;

    const isMobile = window.innerWidth < 640;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const animatedElements = entry.target.querySelectorAll(
              '.animate-reveal-up'
            );
            animatedElements.forEach((element, index) => {
              setTimeout(() => {
                element.classList.add('animate');
              }, index * 150);
            });

            // Start GSAP floating animations for cards
            if (!prefersReducedMotion) {
              const cardElements = entry.target.querySelectorAll('[data-project-card]');
              cardElements.forEach((cardRef) => {
                const movements = isMobile
                  ? [
                      { y: '-=4', x: '+=3', rotation: '-=0.25' },
                      { y: '+=4', x: '-=3', rotation: '-=0.25' },
                      { y: '-=3', rotation: '+=0.25' },
                      { y: '+=3', rotation: '+=0.25' },
                    ]
                  : [
                      { y: '-=8', x: '+=5', rotation: '-=0.5' },
                      { y: '+=8', x: '-=5', rotation: '-=0.5' },
                      { y: '-=6', rotation: '+=0.5' },
                      { y: '+=6', rotation: '+=0.5' },
                    ];

                const durations = [4, 3, 4, 3];
                const cardTimeline = gsap.timeline({ repeat: -1 });
                movements.forEach((movement, moveIndex) => {
                  cardTimeline.to(cardRef, durations[moveIndex], {
                    ...movement,
                    ease: 'power1.easeInOut',
                  });
                });
              });
            }

            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1 }
    );

    observer.observe(section);

    // Cleanup function
    return () => {
      observer.unobserve(section);
      const cardElements = section.querySelectorAll('[data-project-card]');
      cardElements.forEach((cardRef) => {
        gsap.killTweensOf(cardRef);
      });
    };
  });
</script>
