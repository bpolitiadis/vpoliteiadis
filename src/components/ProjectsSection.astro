---
import AImage from './media/AImage.astro';

interface Project {
  title: string;
  description: string;
  website: string;
  image: string;
  technologies: string[];
}

const projects: Project[] = [
  {
    title: "Upiria",
    description: "Joined Upiria at a critical early stage and bridged frontend development with a scalable testing framework, enabling rapid product evolution with confidence.",
    website: "https://www.upiria.com",
    image: "/images/upiria-cover.webp",
    technologies: ["ReactJS", "PHP", "Playwright", "MySQL", "AWS"],
  },
  {
    title: "Casa Capoeira",
    description: "Built a production-ready multilingual CMS for Capoeira academies, enabling seamless management of events, blog posts, and media galleries across global communities.",
    website: "https://www.casacapoeira.org",
    image: "/images/casacapoeira-cover.png",
    technologies: ["NextJS", "Supabase", "TypeScript", "Playwright", "Prisma"],
  },
];
---

<section
  id="projects"
  class="relative py-24 md:py-32 lg:py-40 xl:py-48 px-4 sm:px-6 lg:px-8 bg-background overflow-visible min-h-[120vh] md:min-h-[100vh]"
  role="region"
  aria-labelledby="projects-heading"
  data-projects-section
>
  {/* Background image */}
  <div class="absolute inset-0 z-0 overflow-hidden">
    <AImage
      src="/images/projects-bg.webp"
      alt=""
      preset="hero"
      class="w-full h-full object-cover object-center"
      aria-hidden="true"
    />
    <div class="absolute inset-0 bg-background/50"></div>
  </div>

  {/* Background decorative elements */}
  <div class="absolute inset-0 z-0 overflow-hidden pointer-events-none">
    <div class="absolute top-0 left-1/4 w-px h-32 bg-gradient-to-b from-primary/20 to-transparent" />
    <div class="absolute top-0 right-1/4 w-px h-32 bg-gradient-to-b from-secondary/20 to-transparent" />
    <div class="absolute bottom-0 left-1/2 w-px h-24 bg-gradient-to-t from-primary/10 to-transparent" />
  </div>

  <div class="max-w-7xl mx-auto relative z-10">
    {/* Section Headline */}
    <div class="text-center mb-12 md:mb-16 animate-reveal-up opacity-0">
      <h2
        id="projects-heading"
        class="text-3xl md:text-4xl lg:text-5xl font-orbitron font-bold text-neon-lime mb-3 text-shadow-neon"
      >
        Featured Projects
      </h2>
      <p class="text-base md:text-lg text-matrix-white/70 font-inter max-w-2xl mx-auto">
        Projects worth exploring
      </p>
    </div>

    {/* Projects Grid - Centered with Equal Sizing */}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 max-w-5xl mx-auto">
      {projects.map((project, index) => (
        <div
          data-project-card={index}
          class="relative flex flex-col animate-reveal-up opacity-0 h-full"
          style={`animation-delay: ${index * 150}ms`}
        >
          {/* Project Image */}
          <div class="relative w-full overflow-hidden rounded-lg" style="aspect-ratio: 16 / 9">
            <a
              href={project.website}
              target="_blank"
              rel="noopener noreferrer"
              class="block w-full h-full"
              aria-label={`Visit ${project.title} website`}
            >
              <AImage
                src={project.image}
                alt={project.title}
                preset="card"
                class="w-full h-full object-cover rounded-lg"
                loading="lazy"
                decoding="async"
              />
            </a>
          </div>

          <div class="flex flex-col space-y-3 mt-4">
            <div class="font-bold leading-none tracking-tight font-orbitron text-lg md:text-xl">
              <a
                href={project.website}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center gap-2 text-neon-lime hover:text-neon-lime/90 transition-colors"
                style="color: #39FF14; text-shadow: 0 0 10px rgba(57, 255, 20, 0.6), 0 0 20px rgba(57, 255, 20, 0.3);"
              >
                {project.title}
                <span class="text-sm opacity-70">â†—</span>
              </a>
            </div>
            <div class="text-sm text-matrix-white/85 leading-relaxed">
              {project.description}
            </div>
            <div class="flex flex-wrap gap-2">
              {project.technologies.map((tech) => (
                <div class="badge-emerald">
                  {tech}
                </div>
              ))}
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  import gsap from 'gsap';

  // IntersectionObserver and GSAP animations - vanilla JS implementation
  document.addEventListener('DOMContentLoaded', () => {
    const section = document.querySelector('[data-projects-section]');
    if (!section) return;

    // Check for reduced motion preference
    const prefersReducedMotion = window.matchMedia(
      '(prefers-reduced-motion: reduce)'
    ).matches;

    const isMobile = window.innerWidth < 640;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const animatedElements = entry.target.querySelectorAll(
              '.animate-reveal-up'
            );
            animatedElements.forEach((element, index) => {
              setTimeout(() => {
                element.classList.add('animate');
              }, index * 150);
            });

            // Start GSAP floating animations for cards
            if (!prefersReducedMotion) {
              const cardElements = entry.target.querySelectorAll('[data-project-card]');
              cardElements.forEach((cardRef) => {
                const movements = isMobile
                  ? [
                      { y: '-=4', x: '+=3', rotation: '-=0.25' },
                      { y: '+=4', x: '-=3', rotation: '-=0.25' },
                      { y: '-=3', rotation: '+=0.25' },
                      { y: '+=3', rotation: '+=0.25' },
                    ]
                  : [
                      { y: '-=8', x: '+=5', rotation: '-=0.5' },
                      { y: '+=8', x: '-=5', rotation: '-=0.5' },
                      { y: '-=6', rotation: '+=0.5' },
                      { y: '+=6', rotation: '+=0.5' },
                    ];

                const durations = [4, 3, 4, 3];
                const cardTimeline = gsap.timeline({ repeat: -1 });
                movements.forEach((movement, moveIndex) => {
                  cardTimeline.to(cardRef, {
                    duration: durations[moveIndex],
                    ...movement,
                    ease: 'power1.easeInOut',
                  });
                });
              });
            }

            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1 }
    );

    observer.observe(section);

    // Cleanup function
    return () => {
      observer.unobserve(section);
      const cardElements = section.querySelectorAll('[data-project-card]');
      cardElements.forEach((cardRef) => {
        gsap.killTweensOf(cardRef);
      });
    };
  });
</script>
