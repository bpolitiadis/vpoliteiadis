---
/**
 * TextAnimationWrapper.astro
 * CSS-based text animation wrapper that applies slide-up animations
 * to children with .text-animation class.
 * 
 * Replaces the React TextAnimation component to avoid hydration issues
 * when mixing Astro HTML with React components.
 */

interface Props {
  class?: string;
}

const { class: className = '' } = Astro.props;
---

<div class:list={['text-animation-wrapper', className]} data-text-animate>
  <slot />
</div>

<style is:global>
  /* Text animation wrapper - ensures content is always visible */
  .text-animation-wrapper .text-animation {
    opacity: 1;
    transform: translateY(0);
    visibility: visible;
  }
  
  /* Initial state for animation (applied via JS when GSAP loads) */
  .text-animation-wrapper.gsap-init .text-animation {
    opacity: 0;
    transform: translateY(100px);
  }
  
  /* Fallback: CSS animation if GSAP takes time to load */
  @keyframes text-reveal {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Reduced motion: disable animations */
  @media (prefers-reduced-motion: reduce) {
    .text-animation-wrapper .text-animation {
      animation: none !important;
      opacity: 1 !important;
      transform: none !important;
    }
  }
</style>

<script>
  import gsap from 'gsap';
  
  function initTextAnimations() {
    const wrappers = document.querySelectorAll('[data-text-animate]');
    
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    
    wrappers.forEach((wrapper) => {
      if (wrapper.classList.contains('gsap-ready')) return;
      
      const textElements = wrapper.querySelectorAll('.text-animation');
      if (textElements.length === 0) return;
      
      // Mark as initialized
      wrapper.classList.add('gsap-ready');
      
      // Create timeline for text animation
      const textTimeline = gsap.timeline({
        defaults: {
          stagger: 0.2,
          duration: 0.3,
        },
      });
      
      if (!prefersReducedMotion) {
        textTimeline.from(textElements, {
          y: 100,
          opacity: 0,
          delay: 0.3,
        });
      } else {
        textTimeline.from(textElements, {
          opacity: 0,
          delay: 0.3,
        });
      }
    });
  }
  
  // Run on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTextAnimations);
  } else {
    initTextAnimations();
  }
</script>
