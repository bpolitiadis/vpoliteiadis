---
// Compact Matrix-inspired navbar with subtle neon styling
import { Icon } from './icons/Icon';
import { Image } from 'astro:assets';
import vpLogo from '../assets/images/vp-logo.png';

export interface Props {
  currentPath?: string;
}

const { currentPath = '/' } = Astro.props;

// Navigation items with proper routing
const navItems = [
  { href: '/', label: 'Home' },
  { href: '/about', label: 'About' },
  { href: '/projects', label: 'Projects' },
  { href: '/creative', label: 'Creative' },
  { href: '/blog', label: 'Blog' },
  { href: '/contact', label: 'Contact' },
];
---

<nav class="navbar-compact sticky top-0 z-50 w-full bg-matrix-black border-b border-neon-lime/10 transition-all duration-200" role="navigation" aria-label="Main navigation" data-testid="navbar">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-14 md:h-16">
      
      <!-- Left: VP logo with subtle glow -->
      <div class="flex-shrink-0">
        <a href="/" class="flex items-center space-x-3 group" aria-label="Vasileios Politeiadis - Home" data-testid="navbar-logo">
          <div class="logo-container relative">
            <Image 
              src={vpLogo}
              alt="Vasileios Politeiadis logo"
              class="w-7 h-7 md:w-8 md:h-8 rounded-md object-contain transition-transform duration-200 group-hover:scale-105"
              width={32}
              height={32}
              loading="eager"
              decoding="async"
              fetchpriority="high"
              sizes="(max-width: 768px) 28px, 32px"
            />
            <!-- Subtle neon glow effect -->
            <div class="logo-glow absolute inset-0 rounded-md bg-neon-lime/15 blur-sm group-hover:bg-neon-lime/25 transition-all duration-200" aria-hidden="true"></div>
          </div>
          <span class="font-orbitron font-bold text-neon-lime text-base md:text-lg hidden sm:block group-hover:text-neon-lime/90 transition-colors duration-200">
            Vasileios Politeiadis
          </span>
        </a>
      </div>

      <!-- Desktop Navigation: Horizontal with compact spacing -->
      <div class="hidden md:block" data-testid="navbar-desktop-menu">
        <div class="flex items-center space-x-2 lg:space-x-3" role="menubar">
          {navItems.map((item) => (
            <a
              href={item.href}
              class={`nav-link-desktop px-3 py-2 text-sm font-medium transition-all duration-200 relative group font-orbitron ${
                currentPath === item.href
                  ? 'text-neon-lime'
                  : 'text-matrix-white/70 hover:text-neon-lime/90'
              }`}
              role="menuitem"
              aria-current={currentPath === item.href ? 'page' : undefined}
              aria-label={`${item.label}${currentPath === item.href ? ' (current page)' : ''}`}
              data-testid={`navbar-link-${item.label.toLowerCase()}`}
            >
              {item.label}
              {/* Active page neon underline */}
              {currentPath === item.href && (
                <div class="nav-active-indicator absolute bottom-0 left-0 right-0 h-0.5 bg-neon-lime shadow-neon transition-all duration-200" aria-hidden="true"></div>
              )}
              {/* Magnetic hover underline */}
              <div class="nav-hover-underline absolute bottom-0 left-1/2 right-1/2 h-0.5 bg-neon-lime/60 transform -translate-x-1/2 scale-x-0 group-hover:scale-x-100 transition-transform duration-200 ease-out" aria-hidden="true"></div>
            </a>
          ))}
        </div>
      </div>

      <!-- Right side: Mobile Menu Button -->
      <div class="flex items-center">
        <!-- Mobile menu button with subtle cyan border -->
        <button
          id="mobile-menu-button"
          class="mobile-menu-btn md:hidden inline-flex h-9 w-9 items-center justify-center rounded-md bg-transparent text-neon-cyan hover:text-neon-cyan/80 hover:bg-neon-cyan/5 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-neon-cyan/40 focus-visible:ring-offset-2 focus-visible:ring-offset-matrix-black"
          aria-label="Toggle mobile navigation menu"
          aria-expanded="false"
          aria-controls="mobile-menu"
          aria-haspopup="menu"
          data-testid="mobile-menu-button"
        >
          <!-- Hamburger icon -->
          <Icon name="Menu" size="sm" className="text-current icon-menu" aria-hidden="true" />
          <!-- Close icon -->
          <Icon name="X" size="sm" className="text-current icon-close" aria-hidden="true" />
        </button>
      </div>
    </div>

    <!-- Mobile Navigation Menu: Compact dropdown covering only top portion -->
    <div id="mobile-menu" class="mobile-menu hidden md:hidden fixed top-0 left-0 right-0 bg-matrix-black z-50 shadow-lg" role="menu" aria-labelledby="mobile-menu-button" data-testid="mobile-menu">
      <div class="flex flex-col">
        <!-- Mobile menu header -->
        <div class="flex justify-end items-center p-4 border-b border-neon-lime/10">
          <button
            id="mobile-close-button"
            class="p-2 text-neon-lime hover:text-neon-lime/80 transition-colors duration-200"
            aria-label="Close menu"
            data-testid="mobile-menu-close"
          >
            <Icon name="X" size="md" className="text-current" aria-hidden="true" />
          </button>
        </div>
        
        <!-- Mobile navigation links -->
        <div class="px-4 py-6 space-y-2" data-testid="mobile-nav-links">
          {navItems.map((item) => (
            <a
              href={item.href}
              class={`mobile-nav-link block px-4 py-3 rounded-lg text-base font-medium transition-all duration-200 font-orbitron ${
                currentPath === item.href
                  ? 'text-neon-lime bg-neon-lime/5 border border-neon-lime/20'
                  : 'text-matrix-white/80 hover:text-neon-lime hover:bg-neon-lime/5'
              }`}
              role="menuitem"
              aria-current={currentPath === item.href ? 'page' : undefined}
              tabindex="0"
              aria-label={`${item.label}${currentPath === item.href ? ' (current page)' : ''}`}
              data-testid={`mobile-nav-link-${item.label.toLowerCase()}`}
            >
              {item.label}
            </a>
          ))}
        </div>
      </div>
    </div>
  </div>
</nav>

<script is:inline src="/scripts/navbar.js" defer></script>

<style>
  /* Toggle icons based on aria-expanded for the mobile menu button */
  .icon-menu { 
    display: inline; 
    transition: opacity 0.2s ease;
  }
  .icon-close { 
    display: none; 
    transition: opacity 0.2s ease;
  }
  
  #mobile-menu-button[aria-expanded="true"] .icon-menu { 
    display: none; 
  }
  #mobile-menu-button[aria-expanded="true"] .icon-close { 
    display: inline; 
  }
  
  /* Custom navbar height - more compact */
  .navbar-compact {
    height: 56px;
  }
  
  @media (max-width: 768px) {
    .navbar-compact {
      height: 48px;
    }
  }
  
  /* Logo glow - subtle and smooth */
  .logo-glow {
    animation: logoGlow 4s ease-in-out infinite alternate;
  }
  
  @keyframes logoGlow {
    0% { opacity: 0.15; }
    100% { opacity: 0.25; }
  }
  
  /* Active page indicator - subtle neon glow */
  .nav-active-indicator {
    box-shadow: 0 0 8px rgba(57, 255, 20, 0.3);
  }
  
  /* Mobile menu slide-down animation with subtle fade */
  .mobile-menu {
    transform: translateY(-12px);
    opacity: 0;
    transition: transform 0.28s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.28s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .mobile-menu.show {
    transform: translateY(0);
    opacity: 1;
  }
  
  /* Hover underline animation - magnetic effect */
  .nav-hover-underline {
    transform-origin: center;
  }
</style>